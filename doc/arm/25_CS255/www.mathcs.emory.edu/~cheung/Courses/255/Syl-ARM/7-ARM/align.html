<META HTTP-EQUIV="expires" CONTENT="0">
<html>

<head>
<style type="text/css">
table {font-size: 100%;}
</style>
</head>

<body
text = "#000000"
link="#00ff00"
vlink="#f00000"
bgcolor="#ffffff"
>

<H3>
<HR>
Data alignment requirement
<HR>
</H3>
<UL>
<P>
<LI> <FONT COLOR="darkmagenta"><B>
     Review
     </B></FONT>
<P>
 <UL>
 <LI> As discussed in the
    <FONT color="red"><B>Structure of the computer memory</B></FONT>
    page
   (<A HREF="../4-intro/memory1.html"</A> click here</A>):
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

 <UL>
 <LI> Due to the way the <FONT color="red"><B>computer memory</B></FONT>
 is <FONT color="blue"><B>wired</B></FONT>,
   some combination of
  <FONT color="red"><B>adjacent memory cells</B></FONT>
  can be
  <FONT color="blue"><B>combine together</B></FONT>
 while <FONT color="red"><B>other combinations</B></FONT>
 are <FONT color="blue"><B>not possible</B></FONT>

 </UL>

</TD> </TR>
</TABLE>
</UL>
<P>
Because of this <FONT color="red"><B>limitation</B></FONT>,
 we 
 <FONT color="blue"><B>must place</B></FONT> 
 <FONT color="red"><B>memory variables</B></FONT> that consist
  of <FONT color="blue"><B><I>multiple</I> cells (bytes)</B></FONT>
   at certain memory locations
<P>
We call these
 <FONT color="red"><B>placement restrictions</B></FONT>:
<P>
<UL>
<TABLE bgcolor="lightcyan" BORDER="5">
<TR> <TD>

 <UL>
 <LI> <FONT color="red"><B>Memory alignment requirements</B></FONT>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </UL>

</TD> </TR>
</TABLE>
</UL>
<P>

 </UL>
<P>
<HR>
<HR>
<HR>
<HR>
<P>
<LI> <FONT COLOR="darkmagenta"><B>
     Memory alignment requirements 
     </B></FONT>
<P>
<UL> 
<LI> In many computer system, the following
    <FONT color="red"><B>memory alignment requirements</B></FONT>
    are imposed:
<P>
<UL>
<TABLE bgcolor="#FFEEEE" BORDER="5">
<TR> <TD>

 <OL>
 <LI> A <FONT color="red"><B>variable</B></FONT> of
    a <FONT color="blue"><B>data type</B></FONT> that take up
    <FONT color="red"><B>4 bytes</B></FONT> of memory must be
    place at a <FONT color="blue"><B>memory address</B></FONT> that is
    <FONT color="red"><B>divisible by 4</B></FONT>
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

 <UL>
 <LI> <FONT color="red"><B><TT>int</TT></B></FONT> typed and
      <FONT color="red"><B><TT>float</TT></B></FONT> typed variables must 
      start at a <FONT color="blue"><B>memory address</B></FONT> that is
    <FONT color="red"><B>divisible by 4</B></FONT>
 </UL>

</TD> </TR>
</TABLE>
</UL>
<P>
<HR>
<P>
 <LI> A <FONT color="red"><B>variable</B></FONT> of
    a <FONT color="blue"><B>data type</B></FONT> that take up
    <FONT color="red"><B>2 bytes</B></FONT> of memory must be
    place at a <FONT color="blue"><B>memory address</B></FONT> that is
    <FONT color="red"><B>divisible by 2 </B></FONT>
    (i.e.: even address)
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

 <UL>
 <LI> <FONT color="red"><B><TT>short</TT></B></FONT> typed variables must 
      start at a <FONT color="blue"><B>memory address</B></FONT> that is
    <FONT color="red"><B>divisible by 2</B></FONT>
 </UL>

</TD> </TR>
</TABLE>
</UL>
<P>
<HR>
<P>
<LI> There are <FONT color="red"><B>no alignment requirements</B></FONT> for
    <FONT color="blue"><B><TT>byte</TT> typed</B></FONT> variables.
 <P>
   These type of variables can be place anywhere in memory.
        
 </OL>

</TD> </TR>
</TABLE>
</UL>
<P>

</UL>

<P>
<HR>
<HR>
<HR>
<HR>
<P>
<LI> <FONT COLOR="darkmagenta"><B>
     Assembler directive to help programmer meet the memory alignment 
    requirement
     </B></FONT>
<P>
<UL>
<LI> The <FONT color="red"><B><TT>.align</TT></B></FONT> directive:
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

<FONT color="blue">
<B>
<PRE>
  <FONT color="red">.align  n</FONT>        // If the current memory address is divisible by <FONT color="red">2<sup>n</sup></FONT>,
                   // this directive is ignored
		   // Otherwise, the assembler will skip forward to
		   // the next memory address that is divisible by <FONT color="red">2<sup>n</sup></FONT>           
</PRE>
</B>
</FONT>

</TD> </TR>
</TABLE>
</UL>
<P>
<B>Example usage:</B>
<P>
<UL>
<TABLE bgcolor="lightcyan" BORDER="5">
<TR> <TD>

 <UL>
 <LI> Suppose you want to define 
      1 <FONT color="red"><B><TT>byte</TT></B></FONT> variable 
      (<FONT color="blue"><B><TT>b = 4</TT></B></FONT>) and
      1 <FONT color="red"><B><TT>int</TT></B></FONT> varriable
      (<FONT color="blue"><B><TT>i = 44</TT></B></FONT>)
<P>
The <FONT color="red"><B>naive solution</B></FONT> is:
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

<FONT color="blue">
<B>
<PRE>
      .data
b:    .byte   4
i:    .4byte  44                 
</PRE>
</B>
</FONT>

</TD> </TR>
</TABLE>
</UL>
<P>
This will <FONT color="red"><B>not work</B></FONT> !!!
<P>
<FONT color="red"><B>Reason:</B></FONT>
<P>
<UL>
<TABLE bgcolor="#FFEEEE" BORDER="5">
<TR> <TD>

 <UL>
 <LI> The <FONT color="red"><B><TT>.data</TT> segment</B></FONT>
     starts out as <FONT color="blue"><B>align</B></FONT>
    (address 0 is divisible by every number)
<P>
<LI> After the definition:
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

<FONT color="blue">
<B>
<PRE>
   b: .byte  4            
</PRE>
</B>
</FONT>

</TD> </TR>
</TABLE>
</UL>
<P>
the assembler allocates <FONT color="red"><B>1 byte</B></FONT> for
  the <FONT color="blue"><B>variable <TT>b</TT></B></FONT>.
<P>
And now the <FONT color="red"><B>current address = 1</B></FONT> which
 is <FONT color="blue"><B>not divisible by 4</B></FONT>
<P>
<LI> <B>Therefore</B>, the
     <FONT color="red"><B>next variable definition</B></FONT>:
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

<FONT color="blue">
<B>
<PRE>
    i:  .4byte    44               
</PRE>
</B>
</FONT>

</TD> </TR>
</TABLE>
</UL>
<P>
will put the <FONT color="red"><B><TT>int</TT> variable</B></FONT>
at an address that is
 <FONT color="blue"><B>not</B></FONT>
 <FONT color="red"><B>divisible by 4</B></FONT> !!!
 </UL>

</TD> </TR>
</TABLE>
</UL>
<P>
<HR>
<HR>
<P>
<LI> <FONT color="red"><B>Solution:</B></FONT>
      <FONT color="blue"><B>align </B></FONT> each variable
      definition by its requirement alignment
<P>
So:
<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

<FONT color="blue">
<B>
<PRE>
      .data
b:    .byte   4            // byte typed variable has no alignment requirement    

     <FONT color="red"> .align 2             // Skip to an address that is div by 4 (= 2<sup>2</sup>) first</FONT>
i:    .4byte  44        
</PRE>
</B>
</FONT>

</TD> </TR>
</TABLE>
</UL>
<P>

 </UL>

</TD> </TR>
</TABLE>
</UL>
<P>
<HR>
<HR>
<P>
I want to show you the
 <FONT color="red"><B>effect</B></FONT> of
  <FONT color="blue"><B>misaligned data definition</B></FONT> here.
<P>
Although you don't have assembler programming, you can tell that
 the <FONT color="red"><B>values</B></FONT> used in the variables
 are <FONT color="blue"><B>4</B></FONT> and
 <FONT color="blue"><B>44</B></FONT>.
<P>
In class, I will show you the execution of this program:

<P>
<UL>
<TABLE bgcolor="lightyellow" BORDER="5">
<TR> <TD>

<FONT color="blue">
<B>
<PRE>
    <FONT color="red">/home/cs255001/demo/asm/2-mov/align.s</FONT>       
</PRE>
</B>
</FONT>

</TD> </TR>
</TABLE>
</UL>
<P>
In one case, I will <FONT color="red"><B>not</B></FONT> use
 the <FONT color="blue"><B><TT>.align</TT> directive</B></FONT>
 in the program - and when I run it; you will see that
 the value <FONT color="red"><B>44</B></FONT> will
  <FONT color="blue"><B><I>fail</I></B></FONT> to be loaded into
 the CPU.
<P>
In the second case, I will <FONT color="red"><B>use</B></FONT> 
 the <FONT color="blue"><B><TT>.align</TT> directive</B></FONT>
 in the program - and when I run the
  <FONT color="blue"><B>same program</B></FONT>; and you will see that
 the value <FONT color="red"><B>44</B></FONT> will
  <FONT color="blue"><B><I>appear</I></B></FONT> in
  <FONT color="red"><B>register r2</B></FONT> of the CPU.

</UL>


<P>
</UL>
<P>
<HR>
<HR>
<HR>
<HR>


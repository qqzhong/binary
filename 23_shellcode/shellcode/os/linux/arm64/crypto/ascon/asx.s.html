<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>/home/user/hub/shellcode/os/linux/arm64/crypto/ascon/asx.s.html</title>
<meta name="Generator" content="Vim/8.0">
<meta name="plugin-version" content="vim7.4_v2">
<meta name="syntax" content="arm">
<meta name="settings" content="use_css,pre_wrap,no_foldcolumn,prevent_copy=">
<meta name="colorscheme" content="none">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
* { font-size: 1em; }
.Constant { color: #c00000; }
.Comment { color: #0000c0; }
.Type { color: #008000; }
.Identifier { color: #008080; }
.Statement { color: #af5f00; }
.Todo { color: #000000; background-color: #ffff00; padding-bottom: 1px; }
.PreProc { color: #c000c0; }
-->
</style>

<script type='text/javascript'>
<!--

-->
</script>
</head>
<body>
<pre id='vimCodeElement'>
<span class="Comment">/**</span>
<span class="Comment">  Copyright (C) 2018 Odzhan. All Rights Reserved.</span>

<span class="Comment">  Redistribution and use in source and binary forms, with or without</span>
<span class="Comment">  modification, are permitted provided that the following conditions are</span>
<span class="Comment">  met:</span>

<span class="Comment">  1. Redistributions of source code must retain the above copyright</span>
<span class="Comment">  </span><span class="Todo">notice</span><span class="Comment">, this list of conditions and the following disclaimer.</span>

<span class="Comment">  2. Redistributions in binary form must reproduce the above copyright</span>
<span class="Comment">  </span><span class="Todo">notice</span><span class="Comment">, this list of conditions and the following disclaimer in the</span>
<span class="Comment">  documentation and/or other materials provided with the distribution.</span>

<span class="Comment">  3. The name of the </span><span class="Todo">author</span><span class="Comment"> may not be used to endorse or promote products</span>
<span class="Comment">  derived from this software without specific prior written permission.</span>

<span class="Comment">  THIS SOFTWARE IS PROVIDED BY AUTHORS &quot;AS IS&quot; AND ANY EXPRESS OR</span>
<span class="Comment">  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<span class="Comment">  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="Comment">  DISCLAIMED. IN NO EVENT SHALL THE </span><span class="Todo">AUTHOR</span><span class="Comment"> BE LIABLE FOR ANY DIRECT,</span>
<span class="Comment">  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="Comment">  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="Comment">  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<span class="Comment">  HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>
<span class="Comment">  STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<span class="Comment">  ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="Comment">  POSSIBILITY OF SUCH DAMAGE. */</span>


<span class="Comment">// ASCON in ARM64 assembly</span>
<span class="Comment">// 192 bytes</span>

    <span class="PreProc">.arch</span> <span class="Identifier">armv8</span><span class="Statement">-</span><span class="Identifier">a</span>
    <span class="PreProc">.text</span>

    <span class="PreProc">.global</span> <span class="Identifier">ascon</span>

<span class="Identifier">ascon:</span>
    <span class="Statement">mov</span>    <span class="Type">x10</span><span class="Statement">,</span> <span class="Type">x0</span>
    <span class="Comment">// load 320-bit state</span>
    <span class="Statement">ldp</span>    <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> [<span class="Type">x10</span>]
    <span class="Statement">ldp</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> [<span class="Type">x10</span><span class="Statement">,</span> <span class="Constant">16</span>]
    <span class="Statement">ldr</span>    <span class="Type">x4</span><span class="Statement">,</span> [<span class="Type">x10</span><span class="Statement">,</span> <span class="Constant">32</span>]

    <span class="Comment">// apply 12 rounds</span>
    <span class="Statement">mov</span>    <span class="Type">x11</span><span class="Statement">,</span> <span class="Type">xzr</span>
<span class="Identifier">L0:</span>
    <span class="Comment">// add round constant</span>
    <span class="Comment">// x2^=((0xFULL-i)&lt;&lt;4)|i;</span>
    <span class="Statement">mov</span>    <span class="Type">x12</span><span class="Statement">,</span> <span class="Constant">0xF</span>
    <span class="Statement">sub</span>    <span class="Type">x12</span><span class="Statement">,</span> <span class="Type">x12</span><span class="Statement">,</span> <span class="Type">x11</span>
    <span class="Statement">orr</span>    <span class="Type">x12</span><span class="Statement">,</span> <span class="Type">x11</span><span class="Statement">,</span> <span class="Type">x12</span><span class="Statement">,</span> <span class="Statement">lsl</span> <span class="Constant">4</span>
    <span class="Statement">eor</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x12</span>

    <span class="Comment">// apply non-linear layer</span>
    <span class="Comment">// x0^=x4;x4^=x3;x2^=x1;</span>
    <span class="Statement">eor</span>    <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x4</span>
    <span class="Statement">eor</span>    <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x3</span>
    <span class="Statement">eor</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x1</span>

    <span class="Comment">// t4=(x0&amp;~x4);t3=(x4&amp;~x3);t2=(x3&amp;~x2);t1=(x2&amp;~x1);t0=(x1&amp;~x0);</span>
    <span class="Statement">bic</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x0</span>
    <span class="Statement">bic</span>    <span class="Type">x6</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x1</span>
    <span class="Statement">bic</span>    <span class="Type">x7</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x2</span>
    <span class="Statement">bic</span>    <span class="Type">x8</span><span class="Statement">,</span> <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x3</span>
    <span class="Statement">bic</span>    <span class="Type">x9</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x4</span>

    <span class="Comment">// x0^=t1;x1^=t2;x2^=t3;x3^=t4;x4^=t0;</span>
    <span class="Statement">eor</span>    <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x6</span>
    <span class="Statement">eor</span>    <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x7</span>
    <span class="Statement">eor</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x8</span>
    <span class="Statement">eor</span>    <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x9</span>
    <span class="Statement">eor</span>    <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x5</span>

    <span class="Comment">// x1^=x0;x0^=x4;x3^=x2;x2=~x2;</span>
    <span class="Statement">eor</span>    <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x0</span>
    <span class="Statement">eor</span>    <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x4</span>
    <span class="Statement">eor</span>    <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x2</span>
    <span class="Statement">mvn</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x2</span>

    <span class="Comment">// apply linear diffusion layer</span>
    <span class="Comment">// x0^=R(x0,19)^R(x0,28);</span>
    <span class="Statement">ror</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Constant">19</span>
    <span class="Statement">eor</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Statement">ror</span> <span class="Constant">28</span>
    <span class="Statement">eor</span>    <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x5</span>

    <span class="Comment">// x1^=R(x1,61)^R(x1,39);</span>
    <span class="Statement">ror</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> <span class="Constant">61</span>
    <span class="Statement">eor</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> <span class="Statement">ror</span> <span class="Constant">39</span>
    <span class="Statement">eor</span>    <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> <span class="Type">x5</span>

    <span class="Comment">// x2^=R(x2,1)^R(x2,6);</span>
    <span class="Statement">ror</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Constant">1</span>
    <span class="Statement">eor</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Statement">ror</span> <span class="Constant">6</span>
    <span class="Statement">eor</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x5</span>

    <span class="Comment">// x3^=R(x3,10)^R(x3,17);</span>
    <span class="Statement">ror</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> <span class="Constant">10</span>
    <span class="Statement">eor</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> <span class="Statement">ror</span> <span class="Constant">17</span>
    <span class="Statement">eor</span>    <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> <span class="Type">x5</span>

    <span class="Comment">// x4^=R(x4,7)^R(x4,41);</span>
    <span class="Statement">ror</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x4</span><span class="Statement">,</span> <span class="Constant">7</span>
    <span class="Statement">eor</span>    <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x5</span><span class="Statement">,</span> <span class="Type">x4</span><span class="Statement">,</span> <span class="Statement">ror</span> <span class="Constant">41</span>
    <span class="Statement">eor</span>    <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x4</span><span class="Statement">,</span> <span class="Type">x5</span>

    <span class="Comment">// i++</span>
    <span class="Statement">add</span>    <span class="Type">x11</span><span class="Statement">,</span> <span class="Type">x11</span><span class="Statement">,</span> <span class="Constant">1</span>
    <span class="Comment">// i &lt; 12</span>
    <span class="Statement">cmp</span>    <span class="Type">x11</span><span class="Statement">,</span> <span class="Constant">12</span>
    <span class="Statement">bne</span>    <span class="Identifier">L0</span>

    <span class="Comment">// save 320-bit state</span>
    <span class="Statement">stp</span>    <span class="Type">x0</span><span class="Statement">,</span> <span class="Type">x1</span><span class="Statement">,</span> [<span class="Type">x10</span>]
    <span class="Statement">stp</span>    <span class="Type">x2</span><span class="Statement">,</span> <span class="Type">x3</span><span class="Statement">,</span> [<span class="Type">x10</span><span class="Statement">,</span> <span class="Constant">16</span>]
    <span class="Statement">str</span>    <span class="Type">x4</span><span class="Statement">,</span> [<span class="Type">x10</span><span class="Statement">,</span> <span class="Constant">32</span>]
    <span class="Statement">ret</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
